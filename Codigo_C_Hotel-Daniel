#define CLIENTES_FILE "clientes.dat"
#define FUNC_FILE "funcionarios.dat"
#define QUARTOS_FILE "quartos.dat"
#define ESTADIAS_FILE "estadias.dat"

typedef struct {
    int codigo;
    char nome[100];
    char endereco[150];
    char telefone[20];
} Cliente;

typedef struct {
    int codigo;
    char nome[100];
    char telefone[20];
    char cargo[30];
    double salario;
} Funcionario;

typedef struct {
    int numero;
    int qtd_hospedes;
    double valor_diaria;
    char status[10]; // "ocupado" ou "desocupado"
} Quarto;

typedef struct {
    int codigo;
    int cliente_codigo;
    int quarto_numero;
    int data_entrada; // YYYYMMDD
    int data_saida;   // YYYYMMDD
    int qtd_diarias;
    int ativo; // 1 = em andamento, 0 = finalizada
} Estadia;

void cadastrar_cliente() {
    Cliente c;
    printf("Digite codigo (0 para gerar automatico): ");
    if(scanf("%d", &c.codigo) != 1) { while(getchar()!='\n'); printf("Entrada invalida.\n"); return; }
    getchar();
    if(c.codigo == 0) {
        // ... código automático ...
        c.codigo = max + 1;
    } else {
        if(existe_cliente(c.codigo, NULL)) {
            printf("Codigo ja existe. Operacao cancelada.\n");
            return;
        }
    }
    printf("Nome: ");
    fgets(c.nome, sizeof(c.nome), stdin);
    c.nome[strcspn(c.nome, "\n")] = 0;
    printf("Endereco: ");
    fgets(c.endereco, sizeof(c.endereco), stdin);
    c.endereco[strcspn(c.endereco, "\n")] = 0;
    printf("Telefone: ");
    fgets(c.telefone, sizeof(c.telefone), stdin);
    c.telefone[strcspn(c.telefone, "\n")] = 0;

    FILE *f = fopen(CLIENTES_FILE, "ab");
    if(!f) { perror("Erro ao abrir arquivo"); return; }
    fwrite(&c, sizeof(c), 1, f);
    fclose(f);
    printf("Cliente cadastrado com codigo %d\n", c.codigo);
}

if(c.codigo == 0) {
    FILE *f = fopen(CLIENTES_FILE, "rb");
    int max = 0;
    if(f) {
        Cliente tmp;
        while(fread(&tmp, sizeof(tmp), 1, f)) if(tmp.codigo > max) max = tmp.codigo;
        fclose(f);
    }
    c.codigo = max + 1;  // ← Geração automática do código
}

// Validação de entrada
if(scanf("%d", &c.codigo) != 1) { 
    while(getchar()!='\n'); 
    printf("Entrada invalida.\n"); 
    return; 
}

// Verificação se cliente já existe
if(existe_cliente(c.codigo, NULL)) {
    printf("Codigo ja existe. Operacao cancelada.\n");
    return;
}

char *case_insensitive_search(const char *haystack, const char *needle) {
    if (!*needle) return (char *)haystack;
    size_t needle_len = strlen(needle);
    for (; *haystack; haystack++) {
        size_t i;
        for (i = 0; i < needle_len; ++i) {
            if (!haystack[i]) break;
            if (tolower((unsigned char)haystack[i]) != tolower((unsigned char)needle[i])) break;
        }
        if (i == needle_len) return (char *)haystack;
    }
    return NULL;
}
